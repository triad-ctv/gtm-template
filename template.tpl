___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "TriAD CTV Pixel",
  "categories": ["ADVERTISING", "REMARKETING", "CONVERSIONS", "ATTRIBUTION", "ANALYTICS"],
  "brand": {
    "id": "triad_ctv",
    "displayName": "TriAD CTV",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "The TriAD CTV Pixel assists with measuring and activating web-based actions for audience targeting and campaign optimization through the triadctv.com platform.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "advertiserId",
    "simpleValueType": true,
    "displayName": "Advertiser ID",
    "help": "This data will be provided to you by the TriAD CTV team"
  },
  {
    "type": "TEXT",
    "name": "pixelId",
    "displayName": "Pixel ID",
    "simpleValueType": true,
    "help": "This data will be provided to you by the TriAD CTV team"
  },
  {
    "type": "TEXT",
    "name": "actionId",
    "displayName": "Action ID",
    "simpleValueType": true,
    "help": "This data will be provided to you by the TriAD CTV team"
  },
  {
    "type": "PARAM_TABLE",
    "name": "dynParams",
    "displayName": "Dynamic Parameters",
    "paramTableColumns": [
      {
        "param": {
          "type": "SELECT",
          "name": "paramKey",
          "displayName": "Parameter Key",
          "macrosInSelect": false,
          "selectItems": [
            {
              "value": "orderid",
              "displayValue": "Transaction ID"
            },
            {
              "value": "v",
              "displayValue": "Transaction Value"
            },
            {
              "value": "vf",
              "displayValue": "Currency Format"
            },
            {
              "value": "td1",
              "displayValue": "1"
            },
            {
              "value": "td2",
              "displayValue": "2"
            },
            {
              "value": "td3",
              "displayValue": "3"
            },
            {
              "value": "td4",
              "displayValue": "4"
            },
            {
              "value": "td5",
              "displayValue": "5"
            },
            {
              "value": "td6",
              "displayValue": "6"
            },
            {
              "value": "td7",
              "displayValue": "7"
            },
            {
              "value": "td8",
              "displayValue": "8"
            },
            {
              "value": "td9",
              "displayValue": "9"
            },
            {
              "value": "td10",
              "displayValue": "10"
            }
          ],
          "simpleValueType": true
        },
        "isUnique": true
      },
      {
        "param": {
          "type": "TEXT",
          "name": "paramValue",
          "displayName": "Parameter Value",
          "simpleValueType": true
        },
        "isUnique": false
      }
    ],
    "help": "These are optional parameters that you may pass through for additional segmentation. In addition to the eComm parameters, the 1-10 parameters are arbitrary and may contain values from your Custom Variables."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole'),
      queryPermission = require('queryPermission'),
      getUrl = require('getUrl'),
      injectHiddenIframe = require('injectHiddenIframe'),
      encodeUriComponent = require('encodeUriComponent');

log("data = ", data);

if ((data.advertiserId === undefined || data.pixelId === undefined) && data.actionId === undefined) {
  log('input data incomplete');
  data.gtmOnFailure();
  return;
}

const src1 = buildSrc1();
if (src1 !== undefined) {
  injectHiddenIframe(src1);
  log('iFrame 1 written');
}

const src2 = buildSrc2();
if (src2 !== undefined) {
  injectHiddenIframe(src2);
  log('iFrame 2 written');
}

data.gtmOnSuccess();

//helper functions
function buildSrc1 () {
  if (data.advertiserId === undefined || data.pixelId === undefined) {
    return;
  }
  
  const url = getUrl();
  const dynParams = processDynParams(data.dynParams);
  log('dynamic parameters: ' + dynParams);

  const src = 'https://insight.adsrvr.org/track/up' + 
              '?adv=' + data.advertiserId + 
              '&ref=' + encodeUriComponent(url) +
              '&upid=' + data.pixelId +
              '&upv=' + '1.1.3' +
              dynParams;
  return src;
}

function buildSrc2 () {
  if (data.actionId === undefined) {
    return;
  }
  
  const src = 'https://tags.w55c.net/rs' +
              '?id=' + data.actionId +
              '&t=marketing';
  return src;
}

function processDynParams (__dynParams__) {
  let result = '';
  if (data.dynParams === undefined) return result;
  __dynParams__.forEach(function (param) {
    if (param.paramValue !== undefined) {
      result += '&' + param.paramKey + '=' + param.paramValue;
    }
  });
  return result;
}

return;


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_hidden_iframe",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tags.w55c.net/rs?id\u003d*"
              },
              {
                "type": 1,
                "string": "https://insight.adsrvr.org/track/up*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 8/31/2022, 11:01:25 AM


